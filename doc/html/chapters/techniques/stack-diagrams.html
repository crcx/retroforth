<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>doc/book/techniques/stack-diagrams</title>
<style type="text/css">

    * { color: #000; background: #fff; max-width: 700px; }
    tt, pre { background: #dedede; color: #111; font-family: monospace;
             white-space: pre; display: block; width: 100%; }
    .indentedcode { margin-left: 2em; margin-right: 2em; }
    .codeblock {
      background: #dedede; color: #111; font-family: monospace;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      padding: 7px;
      display: block;
    }

    .indentedlist { margin-left: 2em; color: #000; }

    span { white-space: pre; }
    .text  { color: #000; white-space: pre; background: #dedede; }
    .colon { color: #000; background: #dedede; }
    .note  { color: #000; background: #dedede; }
    .str   { color: #000; text-decoration: underline; background: #dedede; }
    .num   { color: #000; background: #dedede; font-weight: bold; font-style: italic; }
    .fnum  { color: #000; font-weight: bold; background: #dedede; }
    .ptr   { color: #000; font-weight: bold; background: #dedede; }
    .fetch { color: #000; font-style: italic; background: #dedede; }
    .store { color: #000; font-style: italic; background: #dedede; }
    .char  { color: #000; background: #dedede; }
    .inst  { color: #000; background: #dedede; }
    .defer { color: #000; background: #dedede; }
    .imm   { color: #000; font-weight: bold; background: #dedede; }
    .prim  { color: #000; font-weight: bolder; background: #dedede; }

    .tt    { white-space: pre; font-family: monospace; background: #dedede; }

    .h1, .h2, .h3, .h4 { white-space: normal; }
    .h1 { font-size: 125%; }
    .h2 { font-size: 120%; }
    .h3 { font-size: 115%; }
    .h4 { font-size: 110%; }
    .hr { display: block; height: 2px; background: #000000; }
</style>
</head><body>
<p><span class="h1">Stack Diagrams</span>
<br/><br/>
Most words in RETRO have a stack comment. These look like:
<br/><br/>
<tt class='indentedcode'>(-)</tt>
<tt class='indentedcode'>(nn-n)</tt>
<br/><br/>
As with all comments, a stack comment begins with <span class="tt">(</span> and
should end with a <span class="tt">)</span>. There are two parts to the comment.
On the left side of the <span class="tt">-</span> is what the word <strong>consumes</strong>. On
the right is what it <strong>leaves</strong>.
<br/><br/>
RETRO uses a short notation, with one character per value
taken or left. In general, the following symbols represent
certain types of values.
<br/><br/>
<tt class='indentedcode'>|&nbsp;Notation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Represents&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;-------------------&nbsp;|&nbsp;-----------------------&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;b,&nbsp;n,&nbsp;m,&nbsp;o,&nbsp;x,&nbsp;y,&nbsp;z&nbsp;|&nbsp;generic&nbsp;numeric&nbsp;values&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;variable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;p,&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;pointers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;q&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;quotation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;dictionary&nbsp;header&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</tt>
<tt class='indentedcode'>|&nbsp;f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;`TRUE`&nbsp;or&nbsp;`FALSE`&nbsp;flag.&nbsp;|</tt>
<br/><br/>
In the case of something like <span class="tt">(xyz-m)</span>, RETRO expects z to be
on the top of the stack, with y below it and x below the y
value. And after execution, a single value (m) will be left on
the stack.
<br/><br/>
Words with no stack effect have a comment of (-)
<br/><br/>
For combinators (words consuming quotations), you can include
a sub-comment indicating the expected stack effect of the
quote. E.g.,
<br/><br/>
<tt class='indentedcode'>(q(-f)-)</tt>
<br/><br/>
Indicates a word consuming a quote and returning nothing. The
quote should return a flag.
</p>
</body></html>
